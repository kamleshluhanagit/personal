<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Health Tracker</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: 'Inter', sans-serif; }
.tab { cursor: pointer; }
.tab-active { background-color: #1f2937; }
</style>
</head>
<body class="bg-gray-900 text-white p-6 min-h-screen">

<div class="max-w-3xl mx-auto bg-gray-800 p-6 rounded-2xl shadow-xl">
<h1 class="text-3xl font-bold text-center mb-6">Daily Health Tracker</h1>

<!-- TABS -->
<div class="grid grid-cols-3 mb-6 text-center font-semibold">
  <div id="daily-tab-btn" class="tab tab-active p-3 rounded-xl" onclick="openTab('daily-tab')">Daily Entry</div>
  <div id="viewer-tab-btn" class="tab p-3 rounded-xl" onclick="openTab('viewer-tab')">Record Viewer</div>
  <div id="analytics-tab-btn" class="tab p-3 rounded-xl" onclick="openTab('analytics-tab')">Analytics</div>
</div>

<!-- DAILY ENTRY TAB -->
<div id="daily-tab" class="tab-page">
<form id="health-form" class="space-y-6">

<div>
  <label>Date</label>
  <input id="entry-date" type="date" class="w-full p-3 rounded bg-gray-700" required>
</div>

<div class="grid grid-cols-2 gap-4">
  <div>
    <label>Presence of B</label>
    <select id="presence-b" class="w-full p-3 rounded bg-gray-700"><option>No</option><option>Yes</option></select>
  </div>
  <div>
    <label>Presence of Muc</label>
    <select id="presence-muc" class="w-full p-3 rounded bg-gray-700"><option>No</option><option>Yes</option></select>
  </div>
</div>

<div>
  <label>Frequency of visits</label>
  <input id="frequency" type="number" class="w-full p-3 rounded bg-gray-700">
</div>

<div class="bg-gray-700 p-4 rounded-xl">
  <h2>Medications</h2>
  <input id="pentasa" type="number" placeholder="Pentasa (mg)" class="w-full p-3 rounded bg-gray-600 mb-2">
  <input id="stero" type="number" placeholder="Steroid (mg)" class="w-full p-3 rounded bg-gray-600 mb-2">
  <input id="add-med" type="text" placeholder="Additional Med" class="w-full p-3 rounded bg-gray-600 mb-2">
  <input id="suposit" type="text" placeholder="Suposit" class="w-full p-3 rounded bg-gray-600">
</div>

<div class="space-y-4">
  <input id="breakfast" placeholder="Breakfast" class="w-full p-3 rounded bg-gray-700">
  <input id="lunch" placeholder="Lunch" class="w-full p-3 rounded bg-gray-700">
  <input id="snacks" placeholder="Snacks" class="w-full p-3 rounded bg-gray-700">
  <input id="dinner" placeholder="Dinner" class="w-full p-3 rounded bg-gray-700">
  <input id="juices" placeholder="Additional Juices" class="w-full p-3 rounded bg-gray-700">
</div>

<div>
  <textarea id="comments" rows="3" placeholder="Additional Comments" class="w-full p-3 rounded bg-gray-700"></textarea>
</div>

<div>
  <input id="score" type="number" min="1" max="10" placeholder="Total Score (1â€“10)" class="w-full p-3 rounded bg-gray-700">
</div>

<button type="button" onclick="submitForm()" class="w-full p-4 bg-blue-500 hover:bg-blue-600 rounded-xl">Save Daily Entry</button>
</form>
</div>

<!-- RECORD VIEWER TAB -->
<div id="viewer-tab" class="tab-page hidden">
<h2>View Past Records</h2>
<input type="date" id="viewer-date" class="w-full p-3 rounded bg-gray-700">
<button onclick="loadRecord()" class="w-full mt-4 p-3 bg-green-500 rounded-xl">Load Record</button>
<div id="record-output" class="mt-6"></div>
</div>

<!-- ANALYTICS TAB -->
<div id="analytics-tab" class="tab-page hidden">
<h2>Analytics & Filters</h2>
<div class="grid grid-cols-2 gap-4">
  <input id="score-min" type="number" placeholder="Score Min" class="w-full p-3 rounded bg-gray-700">
  <input id="score-max" type="number" placeholder="Score Max" class="w-full p-3 rounded bg-gray-700">
</div>

<div class="grid grid-cols-2 gap-4 mt-4">
  <select id="filter-b" class="w-full p-3 rounded bg-gray-700">
    <option>All</option><option>Yes</option><option>No</option>
  </select>
  <select id="filter-muc" class="w-full p-3 rounded bg-gray-700">
    <option>All</option><option>Yes</option><option>No</option>
  </select>
</div>

<button onclick="applyAnalytics()" class="w-full mt-4 p-3 bg-purple-500 rounded-xl">Apply Filters</button>
<div id="analytics-output" class="mt-6"></div>
</div>

</div>

<script>
const GOOGLE_API = "https://script.google.com/macros/s/AKfycbxBQSexOs3XOhV5iaq5u4l2Xe-tDLhw9uRikLFOQLgwGcdVqWxeawihCLogpbFPsuIR/exec";

/* TAB HANDLER */
function openTab(tab) {
  document.querySelectorAll(".tab-page").forEach(pg => pg.classList.add("hidden"));
  document.getElementById(tab).classList.remove("hidden");
  document.querySelectorAll(".tab").forEach(tb => tb.classList.remove("tab-active"));
  document.getElementById(tab + "-btn").classList.add("tab-active");
}

/* SUBMIT FORM */
async function submitForm() {
  const data = {
    date: document.getElementById("entry-date").value,
    B: document.getElementById("presence-b").value,
    Muc: document.getElementById("presence-muc").value,
    frequency: document.getElementById("frequency").value,
    pentasa: document.getElementById("pentasa").value,
    stero: document.getElementById("stero").value,
    additionalMed: document.getElementById("add-med").value,
    suposit: document.getElementById("suposit").value,
    breakfast: document.getElementById("breakfast").value,
    lunch: document.getElementById("lunch").value,
    snacks: document.getElementById("snacks").value,
    dinner: document.getElementById("dinner").value,
    juices: document.getElementById("juices").value,
    comments: document.getElementById("comments").value,
    score: document.getElementById("score").value
  };

  try {
    const res = await fetch(GOOGLE_API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    alert("Daily entry saved successfully!");
    document.getElementById("health-form").reset();
  } catch(err) {
    alert("Error saving entry: " + err);
  }
}

/* LOAD RECORD BY DATE */
async function loadRecord() {
  const date = document.getElementById("viewer-date").value;
  if (!date) return;

  const res = await fetch(`${GOOGLE_API}?date=${date}`);
  const data = await res.json();

  if (!data.found) {
    document.getElementById("record-output").innerHTML = `<p class="text-red-400 mt-4">No record found for this date.</p>`;
    return;
  }
  const r = data.record;
  document.getElementById("record-output").innerHTML = `
    <div class="p-4 bg-gray-700 rounded-xl">
      <p><strong>Date:</strong> ${r.date}</p>
      <p><strong>B:</strong> ${r.B}</p>
      <p><strong>Muc:</strong> ${r.Muc}</p>
      <p><strong>Frequency:</strong> ${r.frequency}</p>
      <p><strong>Score:</strong> ${r.score}</p>
      <p><strong>Comments:</strong> ${r.comments}</p>
    </div>`;
}

/* ANALYTICS FILTER */
async function applyAnalytics() {
  const scoreMin = document.getElementById("score-min").value;
  const scoreMax = document.getElementById("score-max").value;
  const filterB = document.getElementById("filter-b").value;
  const filterMuc = document.getElementById("filter-muc").value;

  const res = await fetch(`${GOOGLE_API}?all=true`);
  const rows = await res.json();
  let filtered = rows.records;

  if (scoreMin) filtered = filtered.filter(r => r.score >= scoreMin);
  if (scoreMax) filtered = filtered.filter(r => r.score <= scoreMax);
  if (filterB !== "All") filtered = filtered.filter(r => r.B === filterB);
  if (filterMuc !== "All") filtered = filtered.filter(r => r.Muc === filterMuc);

  document.getElementById("analytics-output").innerHTML = filtered.map(r => `
    <div class="p-4 bg-gray-700 rounded-xl mt-3">
      <strong>${r.date}</strong><br>
      Score: ${r.score}<br>
      B: ${r.B}, Muc: ${r.Muc}, Freq: ${r.frequency}
    </div>`).join("");
}
</script>

</body>
</html>

